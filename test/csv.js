var requirejs = require('requirejs');
requirejs.config({
    baseUrl: 'node_modules/requirejs/',
    nodeRequire: require
});
var assert = require('chai').assert;
var JsCsv = requirejs("../../app/JsCsv");

describe("Checking parsing", function () {

    it("it parses a CSV", function () {
        var csvData = '# 1st line is the header\nID,RA,DEC,VAL1,VAL2\nID1,3.566,12.444,VAL1,VAL2\nID2,33.23,34.4,VAL11,VAL21\n';
        var csvHeader = {
            "name": ["ID", "RA", "DEC", "VAL1", "VAL2"],
            "datatype": ["string", "double", "double", "string", "string"]
        };
        var csv = new JsCsv.Csv(csvData, ',', csvHeader);
        var store = csv.getStore();
        assert.equal(store[1]["ID"], "ID2");
        assert.equal(store[1]["DEC"], 34.4);
    });

    it("it parses a CSV file from HIPS", function () {
        var csvData = '# Progressive catalog: I/337/gaia; norder: 2; ipix: 73; Version date: 2016-09-14T10:12Z\n' +
            '# nLoaded: 25/588712       \n' +
            'ra_ep2000	dec_ep2000	errHalfMaj	errHalfMin	errPosAng	ra	dec	source_id	ref_epoch	ra_error	dec_error	parallax	parallax_error	pm.ra	pm.ra_error	pm.dec	pm.dec_error	ra_dec_corr	duplicated_source	phot_g_n_obs	phot_g_mean_flux	phot_g_mean_flux_error	phot_g_mean_mag	phot_variable_flag	l	b\n' +
            '352.1945649370	-5.3894205381	0.00076	0.00051	90	352.1945346512	-5.3894954274	2632823198785284224	2015.0	0.335	0.223	3.45	0.37	-7.236	0.046	-17.973	0.031	0.315	0	89	4.73555e+07	3.10057e+04	6.336	NOT_AVAILABLE	77.0900990851	-60.6771084651\n' +
            '348.9930290040	-1.4238877956	0.00082	0.00061	90	348.9931402705	-1.4239040696	2638668065160028032	2015.0	0.474	0.274	4.54	0.56	26.696	0.044	-3.906	0.037	0.516	1	95	4.40728e+07	2.48952e+04	6.414	NOT_AVAILABLE	77.2343970687	-55.5850804075\n' +
            '350.0660375790	-3.9191373432	0.00052	0.00043	90	350.0672329700	-3.9195873994	2634027748133599872	2015.0	0.305	0.240	21.50	0.39	286.223	0.028	-108.013	0.023	0.587	0	117	4.13912e+07	3.98871e+04	6.483	NOT_AVAILABLE	75.7853588482	-58.1838486718\n' +
            '345.9886392920	-4.7948616591	0.00087	0.00058	90	345.9899775385	-4.7947040299	2635543699790010752	2015.0	0.498	0.341	33.01	0.51	320.055	0.048	37.831	0.031	0.082	0	62	3.99227e+07	6.49587e+04	6.522	NOT_AVAILABLE	69.2406323206	-56.0206379583\n' +
            '353.5380085544	-1.2476190966	0.00027	0.00022	90	353.5380085544	-1.2476190966	2641159936467722496	2015.0	0.273	0.221							0.182	0	99	7.42884e+07	2.44427e+05	5.847	NOT_AVAILABLE	84.0912209878	-58.1671575660\n' +
            '352.9898601570	-1.0858871822	0.00059	0.00041	90	352.9898980976	-1.0858240638	2644177717927099648	2015.0	0.321	0.207	4.95	0.39	9.104	0.033	15.148	0.024	0.397	0	155	6.72153e+07	4.61692e+04	5.956	NOT_AVAILABLE	83.4088772920	-57.7251777891\n' +
            '352.3624453550	-1.7912139323	0.00056	0.00042	90	352.3623840289	-1.7913074882	2640750746341547648	2015.0	0.324	0.218	3.06	0.40	-14.711	0.030	-22.453	0.024	0.481	0	133	6.65201e+07	9.75602e+04	5.967	NOT_AVAILABLE	81.6819712381	-57.9396166070\n' +
            '353.8690766200	1.3131377195	0.00077	0.00054	90	353.8688798066	1.3130340058	2646207519471005056	2015.0	0.289	0.181	9.52	0.34	-47.223	0.047	-24.891	0.034	0.547	0	143	6.11902e+07	4.60687e+04	6.058	NOT_AVAILABLE	87.1541034852	-56.1890421975\n' +
            '344.5985865210	-1.4102069537	0.00054	0.00047	90	344.5989379959	-1.4102314279	2649234474981812352	2015.0	0.323	0.310	10.93	0.38	84.328	0.029	-5.874	0.024	0.210	0	73	5.05904e+07	3.58274e+04	6.265	NOT_AVAILABLE	71.6607930669	-52.6448090850\n' +
            '344.2785722690	-3.2452178117	0.00081	0.00051	90	344.2786914642	-3.2451565198	2648703376505938688	2015.0	0.241	0.220	9.46	0.29	28.561	0.052	14.710	0.031	0.059	0	79	3.67337e+07	2.42635e+04	6.612	NOT_AVAILABLE	69.1181486591	-53.7162810331\n' +
            '346.9403215880	-0.2960486268	0.00087	0.00062	90	346.9402940882	-0.2960629760	2651224659747415040	2015.0	0.208	0.151	2.04	0.25	-6.600	0.056	-3.444	0.040	0.327	0	102	3.51657e+07	1.39407e+04	6.659	NOT_AVAILABLE	75.7852504532	-53.3993761366\n' +
            '342.6597884650	4.0682089021	0.00075	0.00062	90	342.6598784370	4.0679475352	2657059802318802176	2015.0	0.192	0.246	5.51	0.26	21.539	0.048	-62.728	0.038	0.317	0	34	3.28446e+07	2.06012e+04	6.734	NOT_AVAILABLE	75.2122319711	-47.2998025697\n' +
            '351.0685960343	3.7154061956	0.00044	0.00023	90	351.0685960343	3.7154061956	2659724193867763072	2015.0	0.439	0.226							-0.118	0	102	5.20683e+07	2.43693e+04	6.233	NOT_AVAILABLE	85.2833448993	-52.6655496668\n' +
            '346.0032479710	6.6163406718	0.00065	0.00046	90	346.0031358499	6.6163753393	2663797540851436544	2015.0	0.424	0.317	12.78	0.50	-26.730	0.033	8.320	0.022	0.529	1	127	4.93223e+07	2.53026e+04	6.292	NOT_AVAILABLE	81.3995429587	-47.4060628885\n' +
            '353.3462173970	4.6393203580	0.00081	0.00057	90	353.3462324041	4.6392534927	2660153312640246400	2015.0	0.481	0.346	3.17	0.56	3.590	0.043	-16.048	0.030	0.656	0	104	4.23580e+07	2.34393e+04	6.457	NOT_AVAILABLE	89.2933623756	-53.0577607638\n' +
            '349.9502693180	7.9820940046	0.00073	0.00058	90	349.9501909891	7.9819630385	2664987865267576192	2015.0	0.342	0.235	5.38	0.40	-18.617	0.043	-31.432	0.035	0.309	0	156	4.16079e+07	1.61336e+04	6.477	NOT_AVAILABLE	87.3856974246	-48.4629524962\n' +
            '346.7611498120	3.0522449061	0.00065	0.00046	90	346.7612919341	3.0523083688	2658767859269767296	2015.0	0.286	0.154	6.22	0.35	34.061	0.039	15.231	0.029	0.158	0	101	3.81296e+07	1.69844e+04	6.572	NOT_AVAILABLE	79.0203017051	-50.6992852230\n' +
            '';
        var headerInfo = {
            "name":["ra_ep2000","dec_ep2000","errHalfMaj","errHalfMin","errPosAng","ra","dec","source_id","ref_epoch","ra_error","dec_error","parallax","parallax_error","pm.ra","pm.ra_error","pm.dec","pm.dec_error","ra_dec_corr","duplicated_source","phot_g_n_obs","phot_g_mean_flux","phot_g_mean_flux_error","phot_g_mean_mag","phot_variable_flag","l","b"],
            "datatype":["double","double","float","float","float","double","double","long","float","double","double","double","double","double","double","double","double","double","unsignedByte","short","double","double","double","unicodeChar","double","double"]
        };
        var csv = new JsCsv.Csv(csvData, "\t", headerInfo);
        var geoJson = csv.getGeoJSon({"RA": "ra", "DEC": "dec", "ID": "source_id"}, "Equatorial");
        var features = geoJson.features;
        assert.equal(17, features.length);
    });
});
